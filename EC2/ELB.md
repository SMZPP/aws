**ELB（Elastic Load Balancing）** は、Amazon Web Services（AWS）で提供されるフルマネージドな負荷分散サービスです。ELBは、インターネット経由で送信されるトラフィックを、複数のEC2インスタンスやサービスに分散させ、アプリケーションの高可用性、スケーラビリティ、耐障害性を実現します。AWSのELBは、アプリケーションの負荷を効率的に管理するために重要な役割を果たします。

以下はELBの詳細な説明です。

---

### 1. **ELBの主な役割と利点**
- **負荷分散**: 複数のバックエンドサーバー（通常はEC2インスタンス）にトラフィックを分散させ、システム全体の負荷を均等に保ちます。
- **可用性の向上**: 障害が発生したインスタンスへのトラフィックを自動的に別のインスタンスにリダイレクトすることで、アプリケーションの可用性を向上させます。
- **スケーラビリティ**: トラフィックの変動に応じて、動的にリソースをスケールできます。
- **セキュリティ**: SSL/TLS終端（SSL/TLSオフロード）機能を提供し、トラフィックの暗号化と復号化をELBが担当することができます。

---

### 2. **ELBの種類**
AWSのELBは、3つの主要な種類に分かれています。それぞれの特徴について説明します。

#### 1. **Classic Load Balancer (CLB)**
- **概要**: AWSの初期のロードバランサーで、レイヤー4（TCP）とレイヤー7（HTTP/HTTPS）の両方のトラフィックを扱えます。
- **特徴**:
  - 単純な負荷分散。
  - EC2-Classic環境（古いインスタンスタイプ）で使用されることが多い。
  - 高度な機能（コンテナサポート、ターゲットグループなど）はあまり提供されません。
  - **非推奨**: 現在では、新しいアーキテクチャではALBまたはNLBが推奨されています。

#### 2. **Application Load Balancer (ALB)**
- **概要**: レイヤー7（HTTP/HTTPS）の負荷分散を提供するロードバランサーです。HTTP/HTTPSトラフィックに対する高度なルーティング機能を提供します。
- **特徴**:
  - **パスベース**や**ホストベース**のルーティング（例: `/images/*`に対して画像サーバーへルーティング）。
  - URLパスやホスト名に基づいてリクエストをルーティング。
  - WebSocketのサポート。
  - ターゲットグループを使ったコンテナやマイクロサービスの管理。
  - SSL/TLSオフロードとセキュリティグループの統合。
  - 高度な認証機能（OIDC、Cognito、IAM）。

#### 3. **Network Load Balancer (NLB)**
- **概要**: レイヤー4（TCP）ベースの負荷分散サービスです。非常に低いレイテンシーと高いスループットを提供します。
- **特徴**:
  - **TCPトラフィック**に特化。
  - レイテンシーが非常に低く、秒単位で応答します。
  - 高いスケーラビリティと耐障害性を提供。
  - **静的IPアドレス**を使用することができる（Elastic IPを関連付けることが可能）。
  - SSL/TLSオフロード機能なし（ただし、TLSの終端を設定することは可能）。
  - **UDPサポート**を提供。
  
#### 4. **Gateway Load Balancer (GLB)**
- **概要**: これは新しいロードバランサータイプで、トラフィックの監視や検査を行うネットワークセキュリティ機器やアプライアンスに対する負荷分散を行います。
- **特徴**:
  - **VPC内でネットワークアプライアンスの負荷分散**。
  - **セキュリティ**や**トラフィック解析**を行うアプライアンスに適しています。

---

### 3. **ELBの動作と機能**
- **ターゲットグループ**: ELBはリクエストをターゲットグループにルーティングします。ターゲットグループは、ELBが負荷分散するEC2インスタンス、コンテナ、Lambda関数などのリソースを定義します。
- **ヘルスチェック**: ELBはターゲットの**ヘルスチェック**を行い、正常でないターゲットにはトラフィックを送信しません。これにより、障害が発生したインスタンスにはトラフィックが送られず、システムの可用性が向上します。
- **SSL/TLSのオフロード**: ELBは、SSL/TLSの暗号化と復号化を処理することができ、これによりバックエンドサーバーの負荷を軽減できます。
- **セッションスティッキネス（セッション維持）**: 一部のアプリケーションでは、同じクライアントからのリクエストを常に同じターゲットにルーティングする必要があります。このような場合、ELBのセッションスティッキネスを使用することができます。

---

### 4. **ELBの利用シーン**
ELBは、以下のようなシーンで使用されます。

- **ウェブアプリケーションのスケーリング**: ユーザーのアクセスが増える中で、複数のEC2インスタンスにトラフィックを分散させてスケールできます。
- **高可用性の実現**: AZ（アベイラビリティゾーン）間でトラフィックを分散させ、システムが1つのAZの障害に影響されないようにすることができます。
- **SSLオフロード**: HTTPSトラフィックの終端としてELBを使用し、バックエンドサーバーが暗号化処理から解放されるようにします。

---

### 5. **ELBの料金**
ELBの料金は、使用するタイプ（ALB、NLBなど）やリソースに応じて異なります。主な料金要素は以下の通りです。

- **データ転送**: ELB経由で転送されるデータ量に基づいて課金されます。
- **ロードバランサー時間**: ELBがアクティブな時間に基づいて課金されます。
- **リクエスト数**: ELBが処理するリクエスト数（ALBやNLBの場合）にも料金が発生します。

---

### まとめ
**ELB**は、AWS上でアプリケーションをスケーラブルかつ可用性の高い環境に配置するために欠かせないサービスです。ALBはHTTP/HTTPSトラフィック向けに柔軟なルーティング機能を提供し、NLBはTCPトラフィックを高いパフォーマンスで処理します。アプリケーションの要件に応じて最適なロードバランサーを選択し、システムのスケーリング、可用性、セキュリティを高めることができます。
